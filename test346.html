<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      We say a number is sparse if there are no adjacent ones in its binary
      representation. For example, 21 (10101) is sparse, but 22 (10110) is not.
      For a given input N, find the smallest sparse number greater than or equal
      to N. Do this in faster than O(N log N) time.
    </title>
  </head>
  <body>
    <script>
      function nextSparse(N) {
        // Convert N to binary array (LSB first)
        let bits = N.toString(2).split("").map(Number).reverse();
        bits.push(0); // extra bit for carry safety

        let n = bits.length;
        let lastFinalized = 0;

        for (let i = 1; i < n - 1; i++) {
          // If two adjacent 1s found and next bit is 0
          if (bits[i] === 1 && bits[i - 1] === 1 && bits[i + 1] === 0) {
            bits[i + 1] = 1;

            // Clear all lower bits
            for (let j = i; j >= lastFinalized; j--) {
              bits[j] = 0;
            }

            lastFinalized = i + 1;
          }
        }

        // Convert back to number
        let result = 0;
        for (let i = 0; i < bits.length; i++) {
          result += bits[i] << i;
        }

        return result;
      }
      console.log(nextSparse(21)); // 21 (10101)
    </script>
  </body>
</html>
